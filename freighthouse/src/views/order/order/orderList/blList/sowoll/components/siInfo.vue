<template>
	<div class="bl-info">
		<div class="sub-tit">
			<span>åŸºæœ¬ä¿¡æ¯</span>
		</div>
		<el-row class="row">
			<el-col :span="8" class="column">
				<div class="label">æå•ç±»å‹</div>
				<span class="value">{{ getDictLabelFunc('blType', createItem.blType) }}</span>
				<!-- <el-form-item label="æå•ç±»å‹" prop="blType" class="flex-item">
					<el-select v-model="createItem.blType" size="mini" clearable placeholder="è¯·é€‰æ‹©" style="width: 100%" @change="handleChangeBlType">
						<el-option v-for="(item, index) in custBlDictMap.blType" :label="item.label" :value="item.value" :key="index"> </el-option>
					</el-select>
				</el-form-item> -->
			</el-col>
			<el-col :span="8" class="column">
				<div class="label">æå•å·</div>
				<span class="value">{{ createItem.blNo }}</span>
				<!-- <el-form-item label="æå•å·" prop="blNo" class="flex-item">
					<el-input size="mini" maxlength="60" clearable placeholder="è¯·è¾“å…¥" v-model="createItem.blNo" style="width: 100%" ></el-input>
				</el-form-item> -->
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item required label="å‡ºå•æ–¹å¼" prop="blMode" class="flex-item" :show-message="false">
					<el-select v-model="createItem.blMode" size="mini" clearable placeholder="è¯·é€‰æ‹©" style="width: 100%">
						<el-option v-for="(item, index) in custBlDictMap.blMode" :label="item.label" :value="item.value" :key="index"> </el-option>
					</el-select>
				</el-form-item>
			</el-col>
		</el-row>
		<el-row class="row">
			<el-col :span="8" class="column">
				<el-form-item required label="ä»˜æ¬¾æ–¹å¼" prop="orderInfo.payMode" class="flex-item" :show-message="false">
					<el-select v-model="createItem.orderInfo.payMode" size="mini" clearable placeholder="è¯·é€‰æ‹©" style="width: 100%">
						<el-option v-for="(item, index) in custBlDictMap.payMode" :label="item.label" :value="item.value" :key="index"> </el-option>
					</el-select>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<div class="label">å¤§èˆ¹èˆ¹å/èˆªæ¬¡ï¼š</div>
				<div class="value">{{createItem.orderInfo.vessel}}/{{createItem.orderInfo.voyage}}</div>
			</el-col>
			<el-col :span="8" class="column">
				<div class="label">é©³èˆ¹èˆ¹å/èˆªæ¬¡ï¼š</div>
				<div class="value">{{createItem.orderInfo.bargeVessel}}/{{createItem.orderInfo.bargeVoyage}}</div>
			</el-col>
		</el-row>
		<el-row class="row">
			<el-col :span="8" class="column">
				<div class="label">èˆ¹å…¬å¸ï¼š</div>
				<div class="value">{{createItem.orderInfo.shipCarrierCode}}</div>
			</el-col>
		</el-row>
		<div class="sub-tit">
			<span>æ”¶å‘é€šä¿¡æ¯</span>
		</div>
		<el-row class="row">
			<el-col :span="8" class="column">
				<el-form-item :required="true" label="Shipper(å‘è´§äºº)" prop="blContact.shipper" class="flex-item col-3 shipper-rel" :show-message="false">
					<span slot="label" style="position:relative; z-index:200">
						<span>Shipper(å‘è´§äºº)</span>
						<!-- <el-button type="text" size="mini" @click="openContactPerson('å‘è´§äºº', '')">é€‰æ‹©</el-button> -->
					</span>
					<TextAreaItem
						isNeedCheckRowLen
						@dblclick.native="editDetail('shipper')"
						:required="true"
						keys="shipper"
						label="Shipper(å‘è´§äºº)"
						:rows="6"
						:value.sync="createItem.blContact.shipper"
					></TextAreaItem>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item :required="true" label="Consignee(æ”¶è´§äºº)" prop="blContact.consignee" class="flex-item col-3 shipper-rel" :show-message="false">
					<span slot="label" style="position:relative; z-index:200">
						<span>Consignee(æ”¶è´§äºº)</span>
						<!-- <el-button type="text" size="mini" @click="openContactPerson('æ”¶è´§äºº', '')">é€‰æ‹©</el-button> -->
					</span>
					<TextAreaItem
						isNeedCheckRowLen
						@dblclick.native="editDetail('consignee')"
						:required="true"
						keys="consignee"
						label="Consignee(æ”¶è´§äºº)"
						:rows="6"
						:value.sync="createItem.blContact.consignee"
					></TextAreaItem>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item :required="true" label="Notify Party1(é€šçŸ¥äºº1)" prop="blContact.notify1" class="flex-item col-3 shipper-rel" :show-message="false">
					<span slot="label" style="position:relative; z-index:200">
						<span>Notify Party1(é€šçŸ¥äºº1)</span>
						<!-- <el-button type="text" size="mini" @click="openContactPerson('é€šçŸ¥äºº', '1')">é€‰æ‹©</el-button> -->
					</span>
					<TextAreaItem
						isNeedCheckRowLen
						@dblclick.native="editDetail('notify1')"
						:required="true"
						keys="notify1"
						label="Notify Party1(é€šçŸ¥äºº1)"
						:rows="6"
						:value.sync="createItem.blContact.notify1"
					></TextAreaItem>
				</el-form-item>
			</el-col>
		</el-row>
		<el-row class="row">
			<el-col :span="8" class="column">
				<el-form-item label="Also Notify Party(é€šçŸ¥äºº2)" prop="blContact.notify2" class="flex-item col-3 shipper-rel">
					<span slot="label" style="position:relative; z-index:200">
						<span>Also Notify Party(é€šçŸ¥äºº2)</span>
						<!-- <el-button type="text" size="mini" @click="openContactPerson('é€šçŸ¥äºº', '2')">é€‰æ‹©</el-button> -->
					</span>
					<TextAreaItem
						isNeedCheckRowLen
						@dblclick.native="editDetail('notify2')"
						keys="notify2"
						label="Also Notify Party(é€šçŸ¥äºº2)"
						:rows="6"
						:value.sync="createItem.blContact.notify2"
					></TextAreaItem>
				</el-form-item>
			</el-col>
		</el-row>
		<div class="sub-tit">
			<span>è´§ç‰©ä¿¡æ¯</span>
		</div>
		<el-row class="row">
			<el-col :span="8" class="column">
				<el-form-item required label="å”›å¤´" prop="cargoMark" class="flex-item col-2 shipper-rel" :show-message="false">
					<TextAreaItem @dblclick.native="editDetail('cargoMark')" :regExp="cargoReg" :required="true" keys="cargoMark" label="å”›å¤´" :rows="6" :value.sync="createItem.cargoMark"></TextAreaItem>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item required label="è´§ç‰©æè¿°" prop="cargoDesc" class="flex-item col-2 shipper-rel" :show-message="false">
					<TextAreaItem @dblclick.native="editDetail('cargoDesc')" :regExp="cargoReg" :required="true" keys="cargoDesc" label="è´§ç‰©æè¿°" :rows="6" :value.sync="createItem.cargoDesc"></TextAreaItem>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item label="æå•å¤‡æ³¨" prop="remarkPrint" :show-message="false" class="flex-item col-3 shipper-rel">
					<el-input @focus="handleFocus('remarkPrint')" @dblclick.native="editDetail('remarkPrint')" type="textarea" :rows="6" maxlength="512" show-word-limit size="mini" placeholder="è¯·è¾“å…¥" v-model="createItem.remarkPrint"></el-input>
				</el-form-item>
			</el-col>
		</el-row>
		<div class="sub-tit">
			<span>æ¸¯å£ä¿¡æ¯</span>
		</div>
		<el-row class="row">
			<el-col :span="8" class="column">
				<el-form-item label="æ”¶è´§åœ°" prop="orderInfo.bargePorPortName" :show-message="false" class="flex-item">
					<el-autocomplete
						:debounce="0"
						popper-class="port-autocomplete"
						style="width: 100%"
						size="mini"
						clearable
						v-model="createItem.orderInfo.bargePorPortName"
						:fetch-suggestions="(queryString, cb) => querySearchPorPort(queryString, cb)"
						placeholder="è¯·è¾“å…¥"
						@select="value => handleSelectPort(value, 'bargePorPortCode')"
						@clear="value => handleClearPort(value, 'bargePorPortCode')"
					></el-autocomplete>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item required label="å¤§èˆ¹èµ·è¿æ¸¯" prop="orderInfo.polPortName" :show-message="false" class="flex-item">
					<el-autocomplete
						:debounce="0"
						popper-class="port-autocomplete"
						style="width: 100%"
						size="mini"
						clearable
						v-model="createItem.orderInfo.polPortName"
						:fetch-suggestions="(queryString, cb) => querySearchPolPort(queryString, cb)"
						placeholder="è¯·è¾“å…¥"
						@select="value => handleSelectPort(value, 'polPortCode')"
						@clear="value => handleClearPort(value, 'polPortCode')"
					></el-autocomplete>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item label="ä¸­è½¬æ¸¯" prop="orderInfo.transitPortName" :show-message="false" class="flex-item multi-select-tag">
					<el-autocomplete
						:debounce="0"
						popper-class="port-autocomplete"
						style="width: 100%"
						size="mini"
						clearable
						v-model="createItem.orderInfo.transitPortName"
						:fetch-suggestions="(queryString, cb) => querySearchTransitPort(queryString, cb)"
						placeholder="è¯·è¾“å…¥"
						@select="value => handleSelectPort(value, 'transitPortCode')"
						@clear="value => handleClearPort(value, 'transitPortCode')"
					></el-autocomplete>
				</el-form-item>
			</el-col>
		</el-row>
		<el-row class="row">
			<el-col :span="8" class="column">
				<el-form-item label="å¸è´§æ¸¯" prop="orderInfo.unloadingPortName" :show-message="false" class="flex-item">
					<el-autocomplete
						:debounce="0"
						popper-class="port-autocomplete"
						style="width: 100%"
						size="mini"
						clearable
						v-model="createItem.orderInfo.unloadingPortName"
						:fetch-suggestions="(queryString, cb) => querySearchUnloadPort(queryString, cb)"
						placeholder="è¯·è¾“å…¥"
						@select="value => handleSelectPort(value, 'unloadingPortCode')"
						@clear="value => handleClearPort(value, 'unloadingPortCode')"
					></el-autocomplete>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item label="ç›®çš„åœ°" prop="orderInfo.podPortName" :show-message="false" class="flex-item">
					<el-autocomplete
						:debounce="0"
						popper-class="port-autocomplete"
						style="width: 100%"
						size="mini"
						clearable
						v-model="createItem.orderInfo.podPortName"
						:fetch-suggestions="(queryString, cb) => querySearchPodPort(queryString, cb)"
						placeholder="è¯·è¾“å…¥"
						@select="value => handleSelectPort(value, 'podPortCode')"
						@clear="value => handleClearPort(value, 'podPortCode')"
					></el-autocomplete>
				</el-form-item>
			</el-col>
			<el-col :span="8" class="column">
				<el-form-item label="æœ€ç»ˆç›®çš„åœ°" prop="orderInfo.deliveryPlace" :show-message="false" class="flex-item">
					<el-input size="mini" clearable placeholder="è¯·è¾“å…¥" v-model="createItem.orderInfo.deliveryPlace"></el-input>
				</el-form-item>
			</el-col>
		</el-row>
		<div class="sub-tit">
			<span>è¡¥æ–™é™„ä»¶</span>
		</div>
		<el-row class="row" v-if="siFileList.length">
			<el-col :span="24" class="file-item" v-for="(item, index) in siFileList" :key="index">
				<img :src="require(`@/views/order/order/images/sw/icon-si-file.png`)" class="icon-si-file" alt="">
				<el-button type="text" class="si-file-name" @click="handleViewFile(item)">{{item.fileName}}</el-button>
				<i class="el-icon-circle-close" @click="handleDeleteSiFile(index)"></i>
			</el-col>
		</el-row>
		<el-row class="row">
			<el-form-item label="">
				<el-upload ref="upload" drag class="upload-file-cont" action="#" :multiple="true" :auto-upload="false" :before-upload="getFile" :on-change="handleChangeFile" :on-remove="handleRemove" :file-list="fileList" :disabled="!canSubmit">
					<div class="file-upload">
						<img class="file-upload-img" :src="require('@/views/order/order/images/sw/icon-upload.png')" />
						<div class="file-upload__text">
							<div class="txt">ç‚¹å‡»æˆ–å°†æ–‡ä»¶æ‹–æ‹½åˆ°è¿™é‡Œå¯¼å…¥</div>
							<p class="info">æ”¯æŒ docã€docxã€pdfã€xlsã€xlsxã€jpgã€pngã€jpegã€bmpã€tifã€imageã€txtã€zipã€rar æ ¼å¼æ–‡ä»¶ï¼Œ ä¸”æ–‡ä»¶å¤§å°é™åˆ¶åœ¨100Må†…</p>
						</div>
					</div>
				</el-upload>
				<el-progress v-show="showProcess" :percentage="processLength" :stroke-width="2"></el-progress>
			</el-form-item>
		</el-row>
		<div v-if="contactPersonShow">
			<ContactPerson :config="contactPersonConfig" @close="getContactPerson" />
		</div>
		<el-dialog class="edit-detail-dlg" :title="editTitle" :visible.sync="editVisible" width="50%">
			<TextAreaItem :regExp="editReg" keys="editForm" :maxlength="editInputMaxLength.toString()" :rows="20" :show-word-limit="editInputMaxLength ? true : false" :value.sync="editData"></TextAreaItem>
			<span slot="footer" class="dialog-footer">
				<el-button size="mini" type="primary" @click="editConfirm">ç¡® å®š</el-button>
			</span>
		</el-dialog>
	</div>
</template>

<script>
import store from '@/store'
import { mapState } from 'vuex'
import { getDictLabel } from '@/utils/tools'
import VesselSelect from '@/views/order/order/components/vesselSelect'
import VoyageSelect from '@/views/order/order/components/voyageSelect'
import TextAreaItem from '@/components/Form/textAreaItem'
import ContactPerson from '@/views/order/order/orderList/components/contactPerson.vue'
import { custBlFileList } from '@/api/order/bl'

export default {
	props: {
		createItem: {
			type: Object,
			default: () => ({})
		},
		selectContainerList: {
			type: Array,
			default: () => ([])
		},
		custBlDictMap: {
			type: Object,
			default: () => ({})
		},
		param: {
			type: Object,
			default: () => ({})
		},
		siFileListParam: {
			type: Array,
			default: () => ([])
		}
	},
	data() {
		return {
			iconObj: {
				shipper: false,
				consignee: false,
				notify1: false,
				notify2: false,
				cargoMark: false,
				cargoDesc: false,
				remarkPrint: false
			},
			editData: '',
			editProp: '',
			editVisible: false,
			curProp: '',
			editTitle: '',
			editTitleObj: {
				consignee: 'æ”¶è´§äºº',
				shipper: 'å‘è´§äºº',
				notify1: 'Notify Party',
				notify2: 'Also Notify Party',
				cargoMark: 'å”›å¤´',
				cargoDesc: 'è´§ç‰©æè¿°',
				remarkPrint: 'æå•å¤‡æ³¨'
			},
			editInputMaxLength: '',
			contactPersonShow: false,
			contactPersonConfig: {
				type: 'æ”¶è´§äºº', // ç±»å‹ï¼Œæ”¶è´§äººï¼Œå‘è´§äººï¼Œé€šçŸ¥äºº
				num: '' // é€šçŸ¥äºº1ï¼Œ2ï¼Œ3
			},
			shipCarrierOptions: [],
			canSubmit: true, // å¯æäº¤æ ‡è¯†
			defaultFileSize: 100, //æ–‡ä»¶é»˜è®¤ä¸è¶…è¿‡100M
			sizeLimit: true,
			file: '',
			fileList: [],
			showProcess: false,
			processLength: 0,
			interval: null,
			containersShow: false,
			truckContainerItem: {
				oid: '',
				containerId: '',
				cn: '',
				sn: '',
				so: '',
				containerType: '',
				packageType: '',
				volume: '',
				weight: '',
				quantity: '',
				isCheck: '',
				itemIsCheck: ''
			},
			siFileList: []
		}
	},
	async created() {
		this.siFileList = JSON.parse(JSON.stringify(this.siFileListParam))
		// this.getFileList()
	},
	mounted() {
	},
	watch: {
		siFileListParam: {
			handler(newVal, oldVal) {
				this.siFileList = newVal
			},
			deep: true
		}
	},
	computed: {
		...mapState({
			dictMap: state => state.dict.dictMap
		}),
		editReg() {
			//æ ¹æ®å±æ€§åè®¾ç½®ç¼–è¾‘æ¡†æ­£åˆ™
			if (this.curProp === 'remarkPrint' || this.curProp === 'remark' || ((this.curProp === 'cargoMark' || this.curProp === 'cargoDesc') && this.createItem.orderInfo.podPortName === 'TAICHUNG,TAIWAN')) {
				return /$a/g // ä¸åŒ¹é…ä»»ä½•å†…å®¹
			} else {
				return /[^\x00-\x7F]+/g
			}
		},
		cargoReg() {
			if (this.createItem.orderInfo.podPortName != 'TAICHUNG,TAIWAN') {
				return /[^\x00-\x7F]+/g
			} else {
				return /$a/g // ä¸åŒ¹é…ä»»ä½•å†…å®¹
			}
		},
	},
	components: {
		VesselSelect,
		VoyageSelect,
		TextAreaItem,
		ContactPerson
	},
	methods: {
		getDictLabelFunc(key, val) {
			let dictArr = this.custBlDictMap[key]
			let findItem = dictArr.find(item => item.value === val)
			return (findItem ? findItem.label : '')
		},
		// // é™„ä»¶åˆ—è¡¨
		// getFileList() {
		// 	custBlFileList(this.param).then(res => {
		// 		this.siFileList = res.data || []
		// 	})
		// },
		handleViewFile(row) {
			this.$store.dispatch('order/previewFile', { fileNo: row.fileNo, fileName: row.fileName })
		},
		handleDeleteSiFile(index) {
			this.siFileList.splice(index, 1)
		},
		querySearchPorPort(queryString, cb) {
			this.createItem.orderInfo.bargePorPortCode = null
			this.$store.dispatch('dict/basePortList', { queryString, portAttribute: 'port_of_feeder', state: this.state, isEn: true, systemCode: 'CUST' }).then(data => {
				cb(data)
			})
		},
		querySearchPolPort(queryString, cb) {
			this.createItem.orderInfo.polPortCode = null
			this.$store.dispatch('dict/basePortList', { queryString, portAttribute: 'port_of_basic', state: this.state, isEn: true, systemCode: 'CUST' }).then(data => {
				cb(data)
			})
		},
		querySearchUnloadPort(queryString, cb) {
			this.createItem.orderInfo.unloadingPortCode = null
			this.$store.dispatch('dict/basePortList', { queryString, portAttribute: 'port_of_discharge', state: this.state, isEn: true, systemCode: 'CUST' }).then(data => {
				cb(data)
			})
		},
		querySearchPodPort(queryString, cb) {
			this.createItem.orderInfo.podPortCode = null
			this.$store.dispatch('dict/basePortList', { queryString, portAttribute: 'port_of_destination', state: this.state, isEn: true, systemCode: 'CUST' }).then(data => {
				cb(data)
			})
		},
		querySearchTransitPort(queryString, cb) {
			this.createItem.orderInfo.transitPortCode = null
			this.$store.dispatch('dict/basePortList', { queryString, portAttribute: 'port_of_basic', state: this.state, isEn: true, systemCode: 'CUST' }).then(data => {
				cb(data)
			})
		},
		handleSelectPort(value, type) {
			this.createItem.orderInfo[type] = value.portCode
		},
		handleClearPort(value, type) {
			this.createItem.orderInfo[type] = null
		},
		handleFocus(val) {
			// 20211112å˜æ›´ä¸´æ—¶ä¸æ˜¾ç¤ºæ”¶å‘é€šè¡Œæ•°ï¼Œæœ€å¤§å­—ç¬¦æ•°çš„é™åˆ¶æç¤º
			// this.$set(this.validateBlContact[val], 'showTip', true)
			this.iconObj[val] = false
		},
		openContactPerson(type, num) {
			// æ‰“å¼€æ”¶å‘é€šå¼¹çª—
			this.contactPersonConfig.type = type
			this.contactPersonConfig.num = num
			this.contactPersonShow = true
		},
		getContactPerson(action, value, type, num) {
			this.contactPersonShow = false
			if (action === 'Confirm') {
				let str = `${value.companyName ? value.companyName + '\n' : ''}${value.contactAddress ? value.contactAddress + '\n' : ''}${value.contactName ? value.contactName + '\n' : ''}${value.contactPhone ? 'TEL:' + value.contactPhone + '\n' : ''}${
					value.contactFax ? 'FAX:' + value.contactFax + '\n' : ''
				}${value.taxCode ? 'TAX:' + value.taxCode + '\n' : ''}${value.remark}`
				if (type === 'æ”¶è´§äºº') {
					this.$set(this.createItem.blContact, 'consignee', str)
				} else if (type === 'å‘è´§äºº') {
					this.$set(this.createItem.blContact, 'shipper', str)

					console.log('ğŸš€ ~ this.createItem.blContact.shipper', this.createItem.blContact.shipper)
				} else {
					if (num == 1) {
						this.$set(this.createItem.blContact, 'notify1', str)
					} else if (num == 2) {
						this.$set(this.createItem.blContact, 'notify2', str)
					} else {
						// this.createItem.transport.notify3 = str
					}
				}
			}
		},
		//æ‰“å¼€ç¼–è¾‘æ¡†
		editDetail(val) {
			this.editTitle = this.editTitleObj[val]
			this.curProp = val
			if (val === 'remarkPrint' || val === 'remark') {
				this.editInputMaxLength = 512
			} else {
				this.editInputMaxLength = ''
			}
			// if (val === 'cargoMark' || val === 'cargoDesc') {
			// 	this.editInputMaxLength = 2048
			// } else {
			// 	this.editInputMaxLength = 512
			// }
			if (val === 'shipper' || val === 'consignee' || val === 'notify1' || val === 'notify2') {
				this.editData = this.createItem.blContact[val]
			}
			if (val === 'remarkPrint' || val === 'remark' || val === 'cargoMark' || val === 'cargoDesc') {
				this.editData = this.createItem[val]
			}
			if (val === 'forwardAgent') {
				this.editData = this.createItem.orderInfo[val]
			}
			this.editVisible = true
			// this.$nextTick(() => {
			// 	this.$refs.editInput.focus()
			// })
		},
		//å…³é—­ç¼–è¾‘æ¡†
		editConfirm() {
			let val = this.curProp
			if (val === 'shipper' || val === 'consignee' || val === 'notify1' || val === 'notify2') {
				this.createItem.blContact[val] = this.editData
			}
			if (val === 'remarkPrint' || val === 'remark' || val === 'cargoMark' || val === 'cargoDesc') {
				this.$set(this.createItem, val, this.editData)
			}
			if (val === 'forwardAgent') {
				this.createItem.orderInfo[val] = this.editData
			}
			//åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºæ„Ÿå¹å·
			this.iconObj[this.curProp] = /[^\x00-\xff]+/g.test(this.editData)
			this.editVisible = false
		},
		handleChangeBlType(val) {

		},
		// èˆ¹åè¾“å…¥å»ºè®®
		querySearchVessel(queryString, cb) {
			this.$store.dispatch('dict/queryVessleList', { name: queryString }).then(data => {
				cb(data)
			})
		},
		handleSelectVessel(value) {},
		handleClearVessel(value) {},
		// èˆªæ¬¡è¾“å…¥å»ºè®®
		querySearchVoyage(queryString, cb, vessel) {
			this.$store.dispatch('dict/queryVoyageList', { name: queryString, vessel: vessel }).then(data => {
				cb(data)
			})
		},
		handleSelectVoyage(value) {},
		handleClearVoyage(value) {},
		// èˆ¹å…¬å¸ä¸‹æ‹‰
		shipCarrierVisibleChange(val) {
			if (val) {
				this.$store.dispatch('dict/baseShippingCarrierList', { name: '', state: 'valid' }).then(data => {
					this.shipCarrierOptions = data
				})
			}
		},
		shipCarrierFilterMehod(val) {
			if (val === undefined) return
			this.$store.dispatch('dict/baseShippingCarrierList', { name: val, state: 'valid' }).then(data => {
				this.shipCarrierOptions = data
			})
		},
		handleChangeShipCarrier(val) {
			this.getBlackUrlData()
		},
		// ä¸Šä¼ å‰é’©å­è·å–fileå
		getFile(file) {
			this.file = file
			this.sizeLimit = file.size / 1024 / 1024 < this.defaultFileSize
			if (!this.sizeLimit) {
				this.$message.error('ä¸Šä¼ æ–‡ä»¶å¤§å°è¶…è¿‡' + this.defaultFileSize + 'Mé™åˆ¶')
			}
			return this.sizeLimit
		},
		// æ–°æ·»åŠ æ–‡ä»¶æ›¿æ¢ä¹‹å‰æ·»åŠ çš„æ–‡ä»¶
		handleChangeFile(file, fileList) {
			this.fileList = fileList
			// this.fileList = []
			// this.fileList.push(file)
		},
		handleRemove(file, fileList) {
			this.fileList = fileList
		},
		// ä¸Šä¼ è¿›åº¦æ¡
		handleProgress(file, fileList) {
			this.processLength = 0
			this.showProcess = true
			this.interval = setInterval(() => {
				if (this.processLength >= 99) {
					clearInterval(this.interval)
					return
				}
				this.processLength += 1
			}, 200)
		},
		handleImport(values) {
			let siFileNoList = this.siFileList.map(item => item.fileNo)
			let params = {
				data: { ...values, siFileNoList },
				fileName: this.fileList
			}
			if (this.sizeLimit) {
				this.canSubmit = false
				this.handleProgress()
				this.$store
					.dispatch('order/soUpload', {
						uri: '/order/cust/bl/save',
						params: params
					})
					.then(res => {
						this.processLength = 100
						this.showProcess = false
						this.fileList = []
						this.canSubmit = true
						if (res === 'error') return
						this.$message({
							type: 'success',
							message: 'ä¿å­˜æˆåŠŸ',
						})
						this.$emit('refresh', values.type)
					})
					.catch(err => {
						clearInterval(this.interval)
						this.interval = null
						this.processLength=0
						this.showProcess=false
						this.fileList = []
						this.canSubmit = true
					})
			}
		},
	}
}
</script>
<style lang="scss" scoped>
.bl-info {
	.tit {
		height: 24px;
		margin-bottom: 24px;
		.img-tit {
			display: inline-block;
			width: 20px;
			height: 20px;
			margin-right: 8px;
		}
		span {
			font-size: 20px;
			line-height: 24px;
			color: #222222;
			font-weight: bold;
		}
		/deep/ .el-button--mini {
			&.relate-btn {
				padding: 5px 12px;
				float: right;
			}
		}
	}
	.sub-tit {
		height: 40px;
		background: #F4F5F8;
		margin-bottom: 16px;
		span {
			font-size: 12px;
			font-weight: bold;
			color: #222222;
			line-height: 40px;
			margin-left: 8px;
		}
	}
	.row {
		margin-bottom: 24px;
		.item {
			line-height: 20px;
			display: flex;
			padding-left: 14px;
			&:first-child {
				padding-left: 0;
			}
			.label {
				color: #222;
				display: inline-block;
			}
			.value {
				display: inline-block;
				flex: 1;
				word-break: break-all;
				color: #4a4a4a;
				white-space: normal;
			}
		}
		.file-item {
			line-height: 20px;
			display: flex;
			margin-bottom: 8px;
			.si-file-name {
				display: inline-block;
				color: #206EF9;
				padding: 0;
				text-align: left;
				font-size: 12px;
			}
			.icon-si-file {
				display: inline-block;
				width: 16px;
				height: 16px;
				margin-right: 8px;
			}
			.el-icon-circle-close{
				display: none;
				font-size: 16px;
				color: #bbb;
				margin-left: 10px;
				cursor: pointer;
			}
			&:hover {
				.el-icon-circle-close{
					display: inline-block;
				}
			}
		}
		.column {
			line-height: 20px;
			padding-left: 20px;
			&:first-child {
				padding-left: 0;
			}
			.label {
				color: #222;
				margin-bottom: 10px;
			}
			.value {
				color: #4a4a4a;
			}
			/deep/ .input-div {
				border-radius: 0;
				border: 0;
				border-bottom: 1px solid #dcdfe6;
				line-height: 20px;
			}
		}
		/deep/ .el-form-item {
			.el-input__inner {
				border-radius: 0;
				border: 0;
				border-bottom: 1px solid #DCDFE6;
			}
			.el-textarea__inner {
				padding: 2px 8px;
				border-radius: 0;
				border: 0;
				border-bottom: 1px solid #DCDFE6;
			}
			&.is-error {
				.el-input__inner, .el-textarea__inner {
					border-color: #ff4949;
				}
			}
			
		}
		/deep/ .upload-file-cont {
			.file-upload {
				display: flex;
				height: 88px;
				background: #F4F8FF;
				border-radius: 2px;
				border: 1px solid #206EF9;
				padding: 0;
				.file-upload-img {
					width: 36px;
					height: 36px;
					margin: 26px 24px;
				}
				.file-upload__text {
					height: 40px;
					font-size: 12px;
					color: #969696;
					line-height: 20px;
					text-align: left;
					margin: 24px 0;
					.txt {
						line-height: 20px;
						margin-bottom: 0;
					}
					.info {
						text-align: left;
						padding: 0;
					}
				}
			}
		}
	}
}
</style>
